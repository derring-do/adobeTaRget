---
title: "adobeTaRget"
author: "derring-do"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Prerequisites

<details><summary>Adobe IO API Configuration</summary>

1. Get System Admin rights for Adobe IO

1. Generate public certificate and private key per https://helpx.adobe.com/in/marketing-cloud-core/kb/adobe-io-authentication-step-by-step.html:
    - Generate `secret.pem` and `certificate.pem` via:         
      ```bash
      openssl req -nodes -text -x509 -newkey rsa:2048 -keyout secret.pem -out certificate.pem -days 356
      ```

    - Convert `secret.key` to `secret.pem` via: 

      ```bash
      openssl pkcs8 -topk8 -inform PEM -outform DER -in secret.pem -nocrypt > secret.key
      ```
1. Set up New Integration in Adobe IO: Go to https://console.adobe.io > "New Integration" > "Access and API" > select Adobe Solution (Target) > Enter Integration details > Upload `certificate.pem`

1. Use `adobeTaRget::set_adobe_io_credentials()` to set credentials --- or manually populate .Renviron with the following from the IO Console and the directory where you saved secret.pem:

    ```
    adobe_io_ims_host = ims-na1.adobelogin.com
    adobe_io_ims_endpoint_jwt = /ims/exchange/jwt
    adobe_io_org_id = xxx@AdobeOrg
    adobe_io_api_key = xxx
    adobe_io_client_secret = xxx
    adobe_io_tech_acct_id = xxx@techacct.adobe.com
    adobe_io_priv_key_filename = xxx/secret.pem
    ```

</details>
<br>

## Usage

```{r, echo=TRUE}
library(adobeTaRget)
library(dplyr)
exchangeJWTforBearerToken()

# List Activities
activities <- listActivities() %>% filter(grepl("test", name)) %>% select(-thirdPartyId)

# start = manual start datetime; startsAt = scheduled start
activities

# Get AB Performance Report
getAbPerformanceReport("246022")

# View Changelog
getActivityChangelog("246022", activities)
```
